{% comment %}
  Main Collection Section
{% endcomment %}

<div class="collection-page" style="padding-top: 2rem;">
  {%- comment -%} Collection Header {%- endcomment -%}
  <div style="background-color: var(--luxeline-bg); border-bottom: 1px solid var(--luxeline-border); padding: 3rem 0;">
    <div class="luxeline-container">
      <h1 class="luxury-heading" style="font-size: 3rem; margin-bottom: 1rem; color: var(--luxeline-black);">
        {{ collection.title }}
      </h1>
      {% if collection.description != blank %}
        <p style="color: rgba(114, 81, 60, 0.7); max-width: 600px;">
          {{ collection.description }}
        </p>
      {% endif %}
    </div>
  </div>
  
  <div class="luxeline-container" style="padding: 2rem 0;">
    {%- comment -%} Toolbar {%- endcomment -%}
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <button 
          type="button" 
          class="luxeline-button luxeline-button--outline md:hidden" 
          data-mobile-filters-toggle
          style="display: none;"
        >
          {% render 'icon', icon: 'menu' %}
          <span style="margin-left: 0.5rem;">{{ 'collections.toolbar.filters' | t }}</span>
        </button>
        <p style="color: rgba(114, 81, 60, 0.7);">
          {{ collection.products_count }} {{ 'collections.toolbar.products' | t }}
        </p>
      </div>
      
      <div style="position: relative;">
        <select 
          class="luxeline-select" 
          onchange="window.location.href = this.value"
          style="padding-right: 2.5rem; appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'%2372513C\' stroke-width=\'2\'%3e%3cpolyline points=\'6 9 12 15 18 9\'/%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1.5rem;"
        >
          <option value="{{ collection.url }}?sort_by=manual">{{ 'collections.sorting.featured' | t }}</option>
          <option value="{{ collection.url }}?sort_by=best-selling" {% if collection.sort_by == 'best-selling' %}selected{% endif %}>{{ 'collections.sorting.best_selling' | t }}</option>
          <option value="{{ collection.url }}?sort_by=title-ascending" {% if collection.sort_by == 'title-ascending' %}selected{% endif %}>{{ 'collections.sorting.az' | t }}</option>
          <option value="{{ collection.url }}?sort_by=title-descending" {% if collection.sort_by == 'title-descending' %}selected{% endif %}>{{ 'collections.sorting.za' | t }}</option>
          <option value="{{ collection.url }}?sort_by=price-ascending" {% if collection.sort_by == 'price-ascending' %}selected{% endif %}>{{ 'collections.sorting.price_low' | t }}</option>
          <option value="{{ collection.url }}?sort_by=price-descending" {% if collection.sort_by == 'price-descending' %}selected{% endif %}>{{ 'collections.sorting.price_high' | t }}</option>
          <option value="{{ collection.url }}?sort_by=created-descending" {% if collection.sort_by == 'created-descending' %}selected{% endif %}>{{ 'collections.sorting.date_new' | t }}</option>
        </select>
      </div>
    </div>
    
    <div style="display: flex; gap: 2rem;">
      {%- comment -%} Desktop Sidebar Filters {%- endcomment -%}
      <div class="collection-filters" style="width: 280px; flex-shrink: 0; display: none;" data-collection-filters>
        <div style="position: sticky; top: 6rem;">
          <h3 class="luxury-heading" style="font-size: 1.25rem; margin-bottom: 1.5rem; color: var(--luxeline-primary);">
            {{ 'collections.filters.title' | t }}
          </h3>
          
          {%- comment -%} Price Filter {%- endcomment -%}
          {% if section.settings.enable_price_filter %}
            <div style="margin-bottom: 2rem;">
              <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--luxeline-primary);">{{ 'collections.filters.price' | t }}</h4>
              <div style="display: flex; gap: 1rem;">
                <input type="number" placeholder="Min" class="luxeline-input" style="width: 100%;">
                <input type="number" placeholder="Max" class="luxeline-input" style="width: 100%;">
              </div>
            </div>
          {% endif %}
          
          {%- comment -%} Tag Filters {%- endcomment -%}
          {% if section.settings.enable_tag_filter and collection.all_tags.size > 0 %}
            <div style="margin-bottom: 2rem;">
              <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--luxeline-primary);">{{ 'collections.filters.category' | t }}</h4>
              <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                {% for tag in collection.all_tags %}
                  <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="font-size: 0.875rem; color: rgba(114, 81, 60, 0.7);">{{ tag }}</span>
                  </label>
                {% endfor %}
              </div>
            </div>
          {% endif %}
          
          <button type="button" class="luxeline-button luxeline-button--outline luxeline-button--full">
            {{ 'collections.filters.reset' | t }}
          </button>
        </div>
      </div>
      
      {%- comment -%} Product Grid {%- endcomment -%}
      <div style="flex: 1;">
        {% if collection.products.size > 0 %}
          <div class="luxeline-grid luxeline-grid--3" style="margin-bottom: 3rem;">
            {% for product in collection.products %}
              {% render 'product-card', product: product %}
            {% endfor %}
          </div>
          
          {%- comment -%} Pagination {%- endcomment -%}
          {% if paginate.pages > 1 %}
            <div style="display: flex; justify-content: center; align-items: center; gap: 0.5rem;">
              {% if paginate.previous %}
                <a href="{{ paginate.previous.url }}" class="luxeline-button luxeline-button--outline">
                  {% render 'icon', icon: 'chevron-left' %}
                </a>
              {% endif %}
              
              {% for part in paginate.parts %}
                {% if part.is_link %}
                  <a href="{{ part.url }}" class="luxeline-button luxeline-button--outline" style="min-width: 44px;">
                    {{ part.title }}
                  </a>
                {% else %}
                  <span class="luxeline-button luxeline-button--primary" style="min-width: 44px;">
                    {{ part.title }}
                  </span>
                {% endif %}
              {% endfor %}
              
              {% if paginate.next %}
                <a href="{{ paginate.next.url }}" class="luxeline-button luxeline-button--outline">
                  {% render 'icon', icon: 'chevron-right' %}
                </a>
              {% endif %}
            </div>
          {% endif %}
        {% else %}
          <div style="text-align: center; padding: 4rem 2rem;">
            <h2 class="luxury-heading" style="font-size: 2rem; margin-bottom: 1rem; color: var(--luxeline-black);">
              {{ 'collections.empty.title' | t }}
            </h2>
            <p style="color: rgba(114, 81, 60, 0.7); margin-bottom: 2rem;">
              {{ 'collections.empty.description' | t }}
            </p>
            <a href="/collections/all" class="luxeline-button luxeline-button--primary">
              {{ 'collections.empty.button' | t }}
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
@media (min-width: 1025px) {
  .collection-filters {
    display: block !important;
  }
}

@media (max-width: 1024px) {
  .luxeline-button[data-mobile-filters-toggle] {
    display: flex !important;
  }
}
</style>

{% schema %}
{
  "name": "Collection",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_price_filter",
      "label": "Enable Price Filter",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_tag_filter",
      "label": "Enable Tag Filter",
      "default": true
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 12,
      "max": 48,
      "step": 12,
      "label": "Products per page",
      "default": 24
    }
  ]
}
{% endschema %}
